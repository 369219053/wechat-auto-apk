# è‡ªåŠ¨åŒ–æ–‡æ¡£

æœ¬æ–‡æ¡£è®°å½•å¾®ä¿¡ç§åŸŸè‡ªåŠ¨åŒ–APKçš„å¼€å‘è¿›åº¦å’ŒæŠ€æœ¯å®ç°ã€‚

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: å¾®ä¿¡ç§åŸŸè‡ªåŠ¨åŒ–APK
**æŠ€æœ¯æ–¹æ¡ˆ**: AndroidåŸç”Ÿ + AccessibilityService
**å¼€å‘è¯­è¨€**: Java
**ç›®æ ‡è®¾å¤‡**: vivoæ‰‹æœº (Android 15, SDK 35)
**å¼€å‘æ¨¡å¼**: å‘½ä»¤è¡Œç¼–è¯‘ + çœŸæœºæµ‹è¯•

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1ï¸âƒ£ åŸºç¡€æ¡†æ¶æ­å»º (2026-01-04)

#### é¡¹ç›®åˆå§‹åŒ–
- âœ… åˆ›å»ºAndroidé¡¹ç›®ç»“æ„
- âœ… é…ç½®Gradleæ„å»ºç¯å¢ƒ
- âœ… å‡çº§åˆ°Gradle 8.13 + AGP 8.13.1
- âœ… ç”Ÿæˆåº”ç”¨å›¾æ ‡ (ç»¿è‰²Wå›¾æ ‡)

#### ä¸»ç•Œé¢å¼€å‘
- âœ… MainActivity - åº”ç”¨ä¸»ç•Œé¢
- âœ… æœåŠ¡çŠ¶æ€æ˜¾ç¤º (æ— éšœç¢æœåŠ¡ã€æ‚¬æµ®çª—æƒé™)
- âœ… å¯åŠ¨/åœæ­¢æŒ‰é’®
- âœ… Toastæç¤ºåé¦ˆ

#### æ— éšœç¢æœåŠ¡
- âœ… WeChatAccessibilityService - æ ¸å¿ƒæœåŠ¡
- âœ… æœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… å•ä¾‹æ¨¡å¼å®ç°
- âœ… å¯åŠ¨å¾®ä¿¡åŠŸèƒ½

#### æƒé™ç®¡ç†
- âœ… PermissionHelper - æƒé™å·¥å…·ç±»
- âœ… æ— éšœç¢æœåŠ¡æƒé™æ£€æŸ¥
- âœ… æ‚¬æµ®çª—æƒé™æ£€æŸ¥å’Œç”³è¯·

---

### 2ï¸âƒ£ å¾®ä¿¡ç™»å½•æ£€æµ‹ (2026-01-08)

#### åŠŸèƒ½å®ç°
- âœ… é€šè¿‡RecyclerViewåˆ¤æ–­å¾®ä¿¡ç™»å½•çŠ¶æ€
- âœ… ä½¿ç”¨`com.tencent.mm:id/iq`ä½œä¸ºç™»å½•æ ‡è¯†
- âœ… åœ¨`onAccessibilityEvent`ä¸­è‡ªåŠ¨æ£€æµ‹
- âœ… æ—¥å¿—è¾“å‡ºæ£€æµ‹ç»“æœ

#### æŠ€æœ¯è¦ç‚¹
- å¾®ä¿¡ä¸»ç•Œé¢åŒ…å«RecyclerView (resource-id: `com.tencent.mm:id/iq`)
- æœªç™»å½•æ—¶è¯¥RecyclerViewä¸å­˜åœ¨
- å·²ç™»å½•æ—¶å¯ä»¥æ‰¾åˆ°è¯¥èŠ‚ç‚¹

---

### 3ï¸âƒ£ ç‚¹å‡»é€šè®¯å½•æ ‡ç­¾ (2026-01-08)

#### åŠŸèƒ½å®ç°
- âœ… è‡ªåŠ¨ç‚¹å‡»å¾®ä¿¡åº•éƒ¨å¯¼èˆªæ çš„"é€šè®¯å½•"æ ‡ç­¾
- âœ… é€šè¿‡æ–‡æœ¬"é€šè®¯å½•"æŸ¥æ‰¾èŠ‚ç‚¹
- âœ… è‡ªåŠ¨æŸ¥æ‰¾å¯ç‚¹å‡»çš„çˆ¶èŠ‚ç‚¹
- âœ… å»¶è¿Ÿ2ç§’åè‡ªåŠ¨æ‰§è¡Œç‚¹å‡»

#### UIåˆ†æç»“æœ
é€šè¿‡`uiautomator2`åˆ†æå¾®ä¿¡ä¸»ç•Œé¢,æ‰¾åˆ°é€šè®¯å½•æŒ‰é’®çš„ç»“æ„:

```xml
<node index="1"
      text=""
      resource-id="com.tencent.mm:id/nvt"
      class="android.widget.RelativeLayout"
      clickable="true"
      bounds="[180,1507][360,1608]">
    <node text="é€šè®¯å½•" bounds="[237,1567][303,1597]" />
</node>
```

**å…³é”®ä¿¡æ¯**:
- çˆ¶èŠ‚ç‚¹: `RelativeLayout`, resource-id=`com.tencent.mm:id/nvt`, clickable=true
- å­èŠ‚ç‚¹: æ–‡æœ¬"é€šè®¯å½•"
- åæ ‡: bounds=[180,1507][360,1608]

#### æŠ€æœ¯å®ç°

**æ–¹æ³•1: é€šè¿‡æ–‡æœ¬æŸ¥æ‰¾** (å·²é‡‡ç”¨)
```java
List<AccessibilityNodeInfo> nodes = rootNode.findAccessibilityNodeInfosByText("é€šè®¯å½•");
for (AccessibilityNodeInfo node : nodes) {
    AccessibilityNodeInfo clickableNode = findClickableParent(node);
    if (clickableNode != null) {
        clickableNode.performAction(AccessibilityNodeInfo.ACTION_CLICK);
    }
}
```

**æ–¹æ³•2: é€šè¿‡resource-idæŸ¥æ‰¾** (å¤‡é€‰)
```java
List<AccessibilityNodeInfo> nodes = rootNode.findAccessibilityNodeInfosByViewId(
    "com.tencent.mm:id/nvt"
);
```

**æ–¹æ³•3: é€šè¿‡åæ ‡ç‚¹å‡»** (å¤‡é€‰)
```java
// ä½¿ç”¨GestureDescriptionå®ç°åæ ‡ç‚¹å‡»
// ä¸­å¿ƒç‚¹: (270, 1557)
```

#### æŸ¥æ‰¾å¯ç‚¹å‡»çˆ¶èŠ‚ç‚¹çš„å·¥å…·æ–¹æ³•

```java
private AccessibilityNodeInfo findClickableParent(AccessibilityNodeInfo node) {
    if (node == null) return null;
    if (node.isClickable()) return node;

    AccessibilityNodeInfo parent = node.getParent();
    if (parent != null) {
        return findClickableParent(parent);
    }
    return null;
}
```

**é€’å½’æŸ¥æ‰¾é€»è¾‘**:
1. æ£€æŸ¥å½“å‰èŠ‚ç‚¹æ˜¯å¦å¯ç‚¹å‡»
2. å¦‚æœå¯ç‚¹å‡»,è¿”å›å½“å‰èŠ‚ç‚¹
3. å¦‚æœä¸å¯ç‚¹å‡»,é€’å½’æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹
4. ç›´åˆ°æ‰¾åˆ°å¯ç‚¹å‡»èŠ‚ç‚¹æˆ–åˆ°è¾¾æ ¹èŠ‚ç‚¹

---

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯å®ç°

### å¯åŠ¨å¾®ä¿¡åŠŸèƒ½

**é—®é¢˜**: æœ€åˆä½¿ç”¨`PackageManager.getLaunchIntentForPackage()`æ— æ³•å¯åŠ¨å¾®ä¿¡

**è§£å†³æ–¹æ¡ˆ**: ç›´æ¥ä½¿ç”¨ComponentNameæŒ‡å®šå¾®ä¿¡çš„LauncherUI

<augment_code_snippet path="app/src/main/java/com/wechat/auto/service/WeChatAccessibilityService.java" mode="EXCERPT">
````java
private void launchWeChat() {
    Intent intent = new Intent();
    intent.setComponent(new ComponentName(
        "com.tencent.mm",
        "com.tencent.mm.ui.LauncherUI"
    ));
    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);
    startActivity(intent);
}
````
</augment_code_snippet>

**å…³é”®ç‚¹**:
- ä½¿ç”¨`ComponentName`ç›´æ¥æŒ‡å®šActivity
- æ·»åŠ `FLAG_ACTIVITY_NEW_TASK`æ ‡å¿—
- åœ¨æ— éšœç¢æœåŠ¡ä¸­è°ƒç”¨`startActivity()`

---

### æŒ‰é’®å¯ç”¨é€»è¾‘

**é—®é¢˜**: å¯åŠ¨æŒ‰é’®è¢«ç¦ç”¨,æ— æ³•ç‚¹å‡»

**åŸå› **: é”™è¯¯çš„å¯ç”¨æ¡ä»¶ - è¦æ±‚æœåŠ¡å·²è¿è¡Œæ‰èƒ½å¯åŠ¨

**ä¿®å¤**:
````java
// å¯åŠ¨æŒ‰é’®: åªè¦æ— éšœç¢æœåŠ¡å·²å¼€å¯å°±èƒ½ç‚¹å‡»
btnStartService.setEnabled(accessibilityEnabled);

// åœæ­¢æŒ‰é’®: æœåŠ¡è¿è¡Œä¸­æ‰èƒ½ç‚¹å‡»
btnStopService.setEnabled(accessibilityEnabled && serviceRunning);
````

---

### æ— éšœç¢æœåŠ¡é…ç½®

**é…ç½®æ–‡ä»¶**: `res/xml/accessibility_service_config.xml`

````xml
<accessibility-service
    android:accessibilityEventTypes="typeWindowStateChanged|typeWindowContentChanged"
    android:accessibilityFeedbackType="feedbackGeneric"
    android:accessibilityFlags="flagReportViewIds"
    android:canRetrieveWindowContent="true"
    android:notificationTimeout="100"
    android:packageNames="com.tencent.mm" />
````

**å…³é”®é…ç½®**:
- `packageNames="com.tencent.mm"` - åªç›‘å¬å¾®ä¿¡
- `canRetrieveWindowContent="true"` - å…è®¸è¯»å–çª—å£å†…å®¹
- `flagReportViewIds` - æŠ¥å‘ŠView ID

---

## ğŸš€ å¼€å‘æµç¨‹

### å¿«é€Ÿè¿­ä»£æµç¨‹

````bash
# 1. ä¿®æ”¹ä»£ç 
# 2. ç¼–è¯‘APK (1ç§’)
export JAVA_HOME="/Applications/Android Studio.app/Contents/jbr/Contents/Home"
./gradlew assembleDebug

# 3. å®‰è£…åˆ°çœŸæœº
adb -s 192.168.1.3:41239 install -r app/build/outputs/apk/debug/app-debug.apk

# 4. çœŸæœºæµ‹è¯•
# 5. åé¦ˆé—®é¢˜,ç»§ç»­è¿­ä»£
````

**æ•ˆç‡**: ä»ä¿®æ”¹åˆ°å®‰è£…å®Œæˆçº¦**3-5ç§’**

---

## ğŸ“± æµ‹è¯•æµç¨‹

### é¦–æ¬¡ä½¿ç”¨æµç¨‹

1. **å®‰è£…APK**
   ````bash
   adb install app-debug.apk
   ````

2. **å¼€å¯æ— éšœç¢æœåŠ¡**
   - æ‰“å¼€WeChatAutoåº”ç”¨
   - ç‚¹å‡»"å¼€å¯æ— éšœç¢æœåŠ¡"
   - åœ¨è®¾ç½®ä¸­æ‰¾åˆ°"WeChatAuto"
   - æ‰“å¼€å¼€å…³

3. **å¯åŠ¨è‡ªåŠ¨åŒ–ä»»åŠ¡**
   - è¿”å›WeChatAutoåº”ç”¨
   - ç‚¹å‡»"å¯åŠ¨è‡ªåŠ¨åŒ–ä»»åŠ¡"
   - è‡ªåŠ¨æ‰“å¼€å¾®ä¿¡ âœ…

---

## ğŸ› å·²è§£å†³çš„é—®é¢˜

### é—®é¢˜1: Gradleç‰ˆæœ¬ä¸å…¼å®¹

**ç°è±¡**: Android Studioæç¤ºGradleç‰ˆæœ¬è¿‡ä½

**è§£å†³**:
- å‡çº§gradle-wrapper.properties: `gradle-8.13`
- å‡çº§AGP: `8.13.1`

---

### é—®é¢˜2: ç¼–è¯‘å¤±è´¥ - ç¼ºå°‘åº”ç”¨å›¾æ ‡

**ç°è±¡**:
````
error: resource mipmap/ic_launcher not found
````

**è§£å†³**: ä½¿ç”¨ImageMagickç”Ÿæˆåº”ç”¨å›¾æ ‡
````bash
convert -size 192x192 xc:#4CAF50 -gravity center \
  -pointsize 96 -fill white -annotate +0+0 "W" \
  app/src/main/res/mipmap-xxxhdpi/ic_launcher.png
````

---

### é—®é¢˜3: gradle-wrapper.jaræŸå

**ç°è±¡**:
````
ClassNotFoundException: org.gradle.wrapper.GradleWrapperMain
````

**è§£å†³**: é‡æ–°ä¸‹è½½wrapper
````bash
curl -L -o gradle/wrapper/gradle-wrapper.jar \
  https://raw.githubusercontent.com/gradle/gradle/master/gradle/wrapper/gradle-wrapper.jar
````

---

### é—®é¢˜4: å¯åŠ¨æŒ‰é’®æ— ååº”

**ç°è±¡**: ç‚¹å‡»æŒ‰é’®æ²¡æœ‰ä»»ä½•ååº”

**åŸå› **: æŒ‰é’®è¢«ç¦ç”¨ (é”™è¯¯çš„å¯ç”¨é€»è¾‘)

**è§£å†³**: ä¿®æ­£æŒ‰é’®å¯ç”¨æ¡ä»¶

---

### é—®é¢˜5: æ— æ³•å¯åŠ¨å¾®ä¿¡

**ç°è±¡**: Toastæç¤º"ä»»åŠ¡å·²å¯åŠ¨",ä½†å¾®ä¿¡æ²¡æ‰“å¼€

**åŸå› **: `getLaunchIntentForPackage()`è¿”å›null

**è§£å†³**: ä½¿ç”¨ComponentNameç›´æ¥æŒ‡å®šActivity

---

## ğŸ“Š å¼€å‘è¿›åº¦

### V0.1 - åŸºç¡€æ¡†æ¶ âœ… (2026-01-04)

- [x] é¡¹ç›®åˆå§‹åŒ–
- [x] ä¸»ç•Œé¢å¼€å‘
- [x] æ— éšœç¢æœåŠ¡æ¡†æ¶
- [x] æƒé™ç®¡ç†
- [x] å¯åŠ¨å¾®ä¿¡åŠŸèƒ½

### V0.2 - é€šè®¯å½•åŒæ­¥ ğŸš§ (è¿›è¡Œä¸­)

- [x] æ£€æµ‹å¾®ä¿¡ç™»å½•çŠ¶æ€
- [x] ç‚¹å‡»é€šè®¯å½•æ ‡ç­¾
- [ ] è¯»å–é€šè®¯å½•åˆ—è¡¨
- [ ] æå–å¥½å‹ä¿¡æ¯
- [ ] åŒæ­¥åˆ°åç«¯æœåŠ¡å™¨

### V0.3 - AIæ™ºèƒ½ç§ä¿¡ ğŸ“‹ (è®¡åˆ’ä¸­)

- [ ] é€‰æ‹©å¥½å‹
- [ ] è¿›å…¥èŠå¤©ç•Œé¢
- [ ] å‘é€æ¶ˆæ¯
- [ ] AIæ¥å£é›†æˆ
- [ ] æ‰¹é‡å‘é€æ§åˆ¶

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **å¼€å‘è¯­è¨€**: Java
- **æœ€ä½SDK**: API 26 (Android 8.0)
- **ç›®æ ‡SDK**: API 34 (Android 14)
- **æ„å»ºå·¥å…·**: Gradle 8.13
- **Android Gradle Plugin**: 8.13.1
- **æ ¸å¿ƒæŠ€æœ¯**: AccessibilityService

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘æŒ‡å—](./å¼€å‘æŒ‡å—.md) - å‘½ä»¤è¡Œç¼–è¯‘å’ŒçœŸæœºæµ‹è¯•
- [å¸¸è§é—®é¢˜](./å¸¸è§é—®é¢˜.md) - é—®é¢˜æ’æŸ¥å’Œè§£å†³æ–¹æ¡ˆ
- [README](../README.md) - é¡¹ç›®æ€»è§ˆ

---

[è¿”å›README](../README.md)
