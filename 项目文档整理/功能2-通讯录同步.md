# åŠŸèƒ½2: é€šè®¯å½•åŒæ­¥

## ğŸ“– åŠŸèƒ½æ¦‚è¿°

è‡ªåŠ¨è¯»å–å¾®ä¿¡é€šè®¯å½•å¥½å‹åˆ—è¡¨,æ”¯æŒæ»šåŠ¨åŠ è½½æ‰€æœ‰å¥½å‹,æŒ‰é¦–å­—æ¯æ’åº,ä¿å­˜åˆ°æœ¬åœ°,ä¸ºåç»­çš„ç§ä¿¡å‘é€åŠŸèƒ½æä¾›æ•°æ®åŸºç¡€ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… è‡ªåŠ¨æ‰“å¼€å¾®ä¿¡é€šè®¯å½•
- âœ… æ™ºèƒ½æ»šåŠ¨åŠ è½½æ‰€æœ‰å¥½å‹
- âœ… å»é‡å¤„ç†(ä½¿ç”¨HashSet)
- âœ… æŒ‰é¦–å­—æ¯æ’åº(å­—æ¯åœ¨å‰,ç‰¹æ®Šç¬¦å·åœ¨å)
- âœ… ä¿å­˜åˆ°SharedPreferences
- âœ… å®æ—¶æ˜¾ç¤ºåŒæ­¥è¿›åº¦

### æŠ€æœ¯äº®ç‚¹
- âœ… æ™ºèƒ½åœæ­¢åˆ¤æ–­(è¿ç»­5æ¬¡æ— æ–°å¥½å‹)
- âœ… æœ€å¤§æ»šåŠ¨æ¬¡æ•°ä¿æŠ¤(500æ¬¡)
- âœ… æ»šåŠ¨é€Ÿåº¦ä¼˜åŒ–(800msæ»‘åŠ¨æ—¶é•¿)
- âœ… ç­‰å¾…æ—¶é—´ä¼˜åŒ–(1500msåŠ è½½æ—¶é—´)
- âœ… æ•°æ®æ ¼å¼å…¼å®¹(æ”¯æŒæ—§ç‰ˆæœ¬æ•°æ®è¿ç§»)
- âœ… JSONå­—ç¬¦ä¸²å­˜å‚¨(ä¿æŒé¡ºåº)

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

1. **æ‰¹é‡ç§ä¿¡å‡†å¤‡**: ä¸ºæ‰¹é‡å‘é€ç§ä¿¡æä¾›å¥½å‹åˆ—è¡¨
2. **å¥½å‹ç®¡ç†**: æŸ¥çœ‹æ‰€æœ‰å¾®ä¿¡å¥½å‹,æŒ‰å­—æ¯æ’åº
3. **æ•°æ®åˆ†æ**: ç»Ÿè®¡å¥½å‹æ•°é‡,åˆ†æå¥½å‹åˆ†å¸ƒ
4. **é€‰æ‹©æ€§å‘é€**: åœ¨ä»»åŠ¡é…ç½®ä¸­é€‰æ‹©ç‰¹å®šå¥½å‹å‘é€æ¶ˆæ¯
5. **æ•°æ®å¤‡ä»½**: å®šæœŸåŒæ­¥å¥½å‹åˆ—è¡¨,é˜²æ­¢æ•°æ®ä¸¢å¤±

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¾®ä¿¡APP(é€šè®¯å½•ç•Œé¢)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“ AccessibilityService
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WeChatAccessibilityService            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. å¯åŠ¨å¾®ä¿¡                      â”‚  â”‚
â”‚  â”‚  2. ç‚¹å‡»é€šè®¯å½•æ ‡ç­¾                â”‚  â”‚
â”‚  â”‚  3. è¯»å–å½“å‰å±å¹•å¥½å‹              â”‚  â”‚
â”‚  â”‚  4. æ»šåŠ¨åŠ è½½æ›´å¤šå¥½å‹              â”‚  â”‚
â”‚  â”‚  5. å»é‡å¹¶æ’åº                    â”‚  â”‚
â”‚  â”‚  6. ä¿å­˜åˆ°SharedPreferences       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SharedPreferences (æœ¬åœ°å­˜å‚¨)        â”‚
â”‚  - friends_list: JSONå­—ç¬¦ä¸²æ•°ç»„          â”‚
â”‚  - ä¿æŒé¡ºåº,æ”¯æŒå¿«é€Ÿè¯»å–                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä»£ç ç»“æ„

```java
public class WeChatAccessibilityService extends AccessibilityService {

    /**
     * åŒæ­¥é€šè®¯å½•å¥½å‹åˆ—è¡¨
     */
    public void syncContacts() {
        // 1. å¯åŠ¨å¾®ä¿¡
        launchWeChat();

        // 2. ç‚¹å‡»é€šè®¯å½•æ ‡ç­¾
        clickContactsTab();

        // 3. è¯»å–é€šè®¯å½•åˆ—è¡¨
        readContactsList();
    }

    /**
     * è¯»å–é€šè®¯å½•å¥½å‹åˆ—è¡¨(å¸¦æ»šåŠ¨åŠ è½½)
     */
    private void readContactsList() {
        Set<String> allFriends = new HashSet<>();
        int scrollCount = 0;
        int maxScrolls = 500;
        int noNewFriendsCount = 0;

        while (scrollCount < maxScrolls) {
            // è¯»å–å½“å‰å±å¹•çš„å¥½å‹
            Set<String> currentFriends = readCurrentScreenFriends();
            int newFriends = allFriends.size();
            allFriends.addAll(currentFriends);
            newFriends = allFriends.size() - newFriends;

            // åˆ¤æ–­æ˜¯å¦åˆ°åº•
            if (newFriends == 0) {
                noNewFriendsCount++;
                if (noNewFriendsCount >= 5) break;
            } else {
                noNewFriendsCount = 0;
            }

            // æ»šåŠ¨åŠ è½½æ›´å¤š
            scrollContactsList();
            Thread.sleep(1500);
            scrollCount++;
        }

        // æ’åºå¹¶ä¿å­˜
        saveFriendsList(sortFriends(allFriends));
    }
}
```

---

## ğŸ“Š æ•°æ®ç»“æ„

### å¥½å‹åˆ—è¡¨æ•°æ®æ¨¡å‹

**å­˜å‚¨æ ¼å¼**: JSONå­—ç¬¦ä¸²æ•°ç»„

```json
[
  "A",
  "a",
  "A-ywan",
  "A-æ™“å¼ºå©šç¤¼-æ‘„åƒå¤§ç¡•",
  "A-æ¬£æ¬£é…éŸ³",
  "Bå“¥",
  "Bob",
  "Cå°å§",
  "...",
  "å¼ ä¸‰",
  "æå››",
  "ç‹äº”",
  "...",
  "#ç‰¹æ®Šç¬¦å·å¼€å¤´çš„å¥½å‹"
]
```

**æ’åºè§„åˆ™**:
1. å­—æ¯å¼€å¤´çš„å¥½å‹åœ¨å‰(A-Z, a-z)
2. ä¸­æ–‡å¥½å‹åœ¨ä¸­é—´(æŒ‰æ‹¼éŸ³é¦–å­—æ¯)
3. ç‰¹æ®Šç¬¦å·å¼€å¤´çš„å¥½å‹åœ¨å(#, @, ç­‰)

### SharedPreferenceså­˜å‚¨

**Key**: `friends_list`
**Value**: JSONå­—ç¬¦ä¸²

```java
// ä¿å­˜å¥½å‹åˆ—è¡¨
SharedPreferences prefs = getSharedPreferences("WeChatAutoPrefs", MODE_PRIVATE);
SharedPreferences.Editor editor = prefs.edit();

// è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
StringBuilder json = new StringBuilder("[");
for (int i = 0; i < friendsList.size(); i++) {
    if (i > 0) json.append(",");
    json.append("\"").append(friendsList.get(i).replace("\\", "\\\\").replace("\"", "\\\"")).append("\"");
}
json.append("]");

editor.putString("friends_list", json.toString());
editor.apply();
```

### æ•°æ®å…¼å®¹æ€§å¤„ç†

**æ—§ç‰ˆæœ¬**: ä½¿ç”¨`StringSet`å­˜å‚¨(æ— åº)
**æ–°ç‰ˆæœ¬**: ä½¿ç”¨JSONå­—ç¬¦ä¸²å­˜å‚¨(æœ‰åº)

```java
// å…¼å®¹è¯»å–é€»è¾‘
String friendsJson = prefs.getString("friends_list", null);
if (friendsJson != null) {
    // æ–°æ ¼å¼: JSONå­—ç¬¦ä¸²
    parseJsonFriends(friendsJson);
} else {
    // æ—§æ ¼å¼: StringSet
    Set<String> friendsSet = prefs.getStringSet("friends_list", null);
    if (friendsSet != null) {
        // è½¬æ¢ä¸ºæ–°æ ¼å¼
        convertToJsonFormat(friendsSet);
    }
}
```

---

## ğŸ” å…³é”®æŠ€æœ¯ç‚¹

### 1. æ™ºèƒ½æ»šåŠ¨åˆ¤æ–­

**é—®é¢˜**: å¦‚ä½•åˆ¤æ–­å·²ç»æ»šåŠ¨åˆ°åº•éƒ¨?

**è§£å†³æ–¹æ¡ˆ**:
- è¿ç»­5æ¬¡æ²¡æœ‰æ–°å¥½å‹,åˆ¤å®šä¸ºåˆ°åº•
- æœ€å¤§æ»šåŠ¨500æ¬¡,é˜²æ­¢æ— é™å¾ªç¯
- æ¯æ¬¡æ»šåŠ¨åç­‰å¾…1500ms,ç¡®ä¿åˆ—è¡¨åŠ è½½å®Œæˆ

```java
int noNewFriendsCount = 0;
while (scrollCount < 500) {
    int beforeSize = allFriends.size();
    Set<String> currentFriends = readCurrentScreenFriends();
    allFriends.addAll(currentFriends);
    int newFriends = allFriends.size() - beforeSize;

    if (newFriends == 0) {
        noNewFriendsCount++;
        if (noNewFriendsCount >= 5) {
            Log.d(TAG, "å·²åˆ°è¾¾åˆ—è¡¨åº•éƒ¨");
            break;
        }
    } else {
        noNewFriendsCount = 0;
    }

    scrollContactsList();
    Thread.sleep(1500);
    scrollCount++;
}
```

### 2. æ»šåŠ¨æ‰‹åŠ¿ä¼˜åŒ–

**é—®é¢˜**: æ»šåŠ¨å¤ªå¿«å¯¼è‡´åˆ—è¡¨åŠ è½½ä¸åŠæ—¶

**è§£å†³æ–¹æ¡ˆ**:
- æ»‘åŠ¨æ—¶é•¿: 800ms (æ›´æ…¢æ›´è‡ªç„¶)
- ç­‰å¾…æ—¶é—´: 1500ms (ç»™åˆ—è¡¨è¶³å¤ŸåŠ è½½æ—¶é—´)
- æ»‘åŠ¨è·ç¦»: ä»80%ä½ç½®æ»‘åˆ°20%ä½ç½®

```java
private boolean performSwipeGesture(int startX, int startY, int endX, int endY) {
    Path path = new Path();
    path.moveTo(startX, startY);
    path.lineTo(endX, endY);

    // æ»‘åŠ¨æ—¶é•¿800ms
    GestureDescription.StrokeDescription stroke =
        new GestureDescription.StrokeDescription(path, 0, 800);

    GestureDescription.Builder builder = new GestureDescription.Builder();
    builder.addStroke(stroke);

    return dispatchGesture(builder.build(), null, null);
}
```

### 3. å¥½å‹æ’åºç®—æ³•

**é—®é¢˜**: å¦‚ä½•æ¨¡ä»¿å¾®ä¿¡çš„æ’åºè§„åˆ™?

**è§£å†³æ–¹æ¡ˆ**:
- å­—æ¯å¼€å¤´çš„åœ¨å‰(A-Z, a-z)
- ä¸­æ–‡åœ¨ä¸­é—´(æŒ‰æ‹¼éŸ³é¦–å­—æ¯)
- ç‰¹æ®Šç¬¦å·åœ¨å(#, @, ç­‰)

```java
private List<String> sortFriends(Set<String> friendsSet) {
    List<String> friendsList = new ArrayList<>(friendsSet);

    Collections.sort(friendsList, (a, b) -> {
        char firstA = a.charAt(0);
        char firstB = b.charAt(0);

        boolean isLetterA = Character.isLetter(firstA);
        boolean isLetterB = Character.isLetter(firstB);

        if (isLetterA && !isLetterB) return -1;
        if (!isLetterA && isLetterB) return 1;

        return a.compareToIgnoreCase(b);
    });

    return friendsList;
}
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### APKä½¿ç”¨æµç¨‹

1. **æ‰“å¼€åº”ç”¨**
   - å¯åŠ¨"å¾®ä¿¡ç§åŸŸè‡ªåŠ¨åŒ–"APK
   - æ£€æŸ¥æ— éšœç¢æœåŠ¡çŠ¶æ€(åº”æ˜¾ç¤ºâœ…)

2. **åŒæ­¥é€šè®¯å½•**
   - ç‚¹å‡»"åŒæ­¥é€šè®¯å½•"æŒ‰é’®
   - åº”ç”¨ä¼šè‡ªåŠ¨:
     - å¯åŠ¨å¾®ä¿¡
     - ç‚¹å‡»é€šè®¯å½•æ ‡ç­¾
     - æ»šåŠ¨åŠ è½½æ‰€æœ‰å¥½å‹
     - ä¿å­˜åˆ°æœ¬åœ°

3. **æŸ¥çœ‹åŒæ­¥ç»“æœ**
   - ä¸»ç•Œé¢æ˜¾ç¤ºåŒæ­¥çš„å¥½å‹æ•°é‡
   - ä¾‹å¦‚: "å·²åŒæ­¥ 611 ä½å¥½å‹"

4. **é…ç½®è‡ªåŠ¨åŒ–ä»»åŠ¡**
   - ç‚¹å‡»"é…ç½®è‡ªåŠ¨åŒ–ä»»åŠ¡"
   - ç‚¹å‡»"é€‰æ‹©å¥½å‹"
   - æŸ¥çœ‹æŒ‰é¦–å­—æ¯æ’åºçš„å¥½å‹åˆ—è¡¨
   - é€‰æ‹©éœ€è¦å‘é€æ¶ˆæ¯çš„å¥½å‹

### è°ƒè¯•æ–¹æ³•

æŸ¥çœ‹åŒæ­¥æ—¥å¿—:
```bash
# æ¸…ç©ºæ—¥å¿—
adb -s 192.168.1.3:37139 logcat -c

# å®æ—¶æŸ¥çœ‹åŒæ­¥æ—¥å¿—
adb -s 192.168.1.3:37139 logcat | grep "WeChatAutoService"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. åŒæ­¥æ—¶é—´
- å¥½å‹æ•°é‡è¶Šå¤š,åŒæ­¥æ—¶é—´è¶Šé•¿
- 500ä¸ªå¥½å‹å¤§çº¦éœ€è¦1-2åˆ†é’Ÿ
- è¯·è€å¿ƒç­‰å¾…,ä¸è¦ä¸­é€”é€€å‡º

### 2. æ•°æ®å‡†ç¡®æ€§
- æœ€å¤§æ»šåŠ¨æ¬¡æ•°: 500æ¬¡
- è¿ç»­5æ¬¡æ— æ–°å¥½å‹åˆ¤å®šä¸ºåˆ°åº•
- å¦‚æœå¥½å‹æ•°é‡ç‰¹åˆ«å¤š(>5000),å¯èƒ½éœ€è¦å¢åŠ maxScrolls

### 3. ç½‘ç»œè¦æ±‚
- éœ€è¦å¾®ä¿¡å·²ç™»å½•
- éœ€è¦å¼€å¯æ— éšœç¢æœåŠ¡
- å»ºè®®åœ¨WiFiç¯å¢ƒä¸‹åŒæ­¥

### 4. æ•°æ®å®‰å…¨
- å¥½å‹åˆ—è¡¨ä¿å­˜åœ¨æœ¬åœ°SharedPreferences
- ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨
- å¸è½½åº”ç”¨ä¼šæ¸…é™¤æ•°æ®

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: åŒæ­¥çš„å¥½å‹æ•°é‡ä¸å…¨

**åŸå› **:
- æ»šåŠ¨å¤ªå¿«,åˆ—è¡¨åŠ è½½ä¸åŠæ—¶
- æœ€å¤§æ»šåŠ¨æ¬¡æ•°é™åˆ¶(50æ¬¡)

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²ä¼˜åŒ–: æ»šåŠ¨æ—¶é•¿800ms,ç­‰å¾…1500ms
- âœ… å·²ä¼˜åŒ–: æœ€å¤§æ»šåŠ¨æ¬¡æ•°æ”¹ä¸º500æ¬¡
- âœ… å·²ä¼˜åŒ–: è¿ç»­5æ¬¡æ— æ–°å¥½å‹æ‰åœæ­¢

### Q2: ç‚¹å‡»"é…ç½®è‡ªåŠ¨åŒ–ä»»åŠ¡"é—ªé€€

**åŸå› **:
- SharedPreferencesæ•°æ®æ ¼å¼ä¸å…¼å®¹
- æ—§ç‰ˆæœ¬ä½¿ç”¨StringSet,æ–°ç‰ˆæœ¬ä½¿ç”¨JSONå­—ç¬¦ä¸²

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²ä¿®å¤: æ·»åŠ å…¼å®¹æ€§è¯»å–é€»è¾‘
- âœ… å·²ä¿®å¤: è‡ªåŠ¨è½¬æ¢æ—§æ ¼å¼æ•°æ®

### Q3: å¥½å‹åˆ—è¡¨é¡ºåºæ··ä¹±

**åŸå› **:
- HashSetæ— åº
- StringSetæ— åº

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²ä¿®å¤: ä½¿ç”¨JSONå­—ç¬¦ä¸²å­˜å‚¨,ä¿æŒé¡ºåº
- âœ… å·²ä¿®å¤: æŒ‰é¦–å­—æ¯æ’åºåä¿å­˜

---

## ğŸ”„ æ›´æ–°è®°å½•

### V0.3.1 (2026-01-08)
- âœ… ä¼˜åŒ–æ»šåŠ¨é€»è¾‘,æœ€å¤§æ»šåŠ¨æ¬¡æ•°æ”¹ä¸º500æ¬¡
- âœ… ä¼˜åŒ–ç­‰å¾…æ—¶é—´,ä»1000msæ”¹ä¸º1500ms
- âœ… ä¼˜åŒ–æ»šåŠ¨æ—¶é•¿,ä»500msæ”¹ä¸º800ms
- âœ… ä¼˜åŒ–åœæ­¢åˆ¤æ–­,ä»è¿ç»­3æ¬¡æ”¹ä¸º5æ¬¡

### V0.3.0 (2026-01-08)
- âœ… å®Œæˆé€šè®¯å½•åŒæ­¥åŠŸèƒ½
- âœ… æ”¯æŒæ»šåŠ¨åŠ è½½æ‰€æœ‰å¥½å‹
- âœ… æ”¯æŒæŒ‰é¦–å­—æ¯æ’åº
- âœ… æ”¯æŒä¿å­˜åˆ°SharedPreferences
- âœ… ä¿®å¤æ•°æ®æ ¼å¼å…¼å®¹æ€§é—®é¢˜

---

[è¿”å›README](../README.md) | [æŸ¥çœ‹è‡ªåŠ¨åŒ–æ–‡æ¡£](./è‡ªåŠ¨åŒ–æ–‡æ¡£.md) | [æŸ¥çœ‹å¸¸è§é—®é¢˜](./å¸¸è§é—®é¢˜.md)

