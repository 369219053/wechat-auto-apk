# 功能1: 朋友圈自动采集

## 📖 功能概述

自动采集指定微信好友的朋友圈内容,包括文字、图片、视频链接等,并存储为Markdown文件和飞书多维表格。

---

## ✨ 功能特性

### 核心功能
- ✅ 自动登录微信(需手动登录一次)
- ✅ 支持单个好友朋友圈采集
- ✅ 支持批量好友朋友圈采集
- ✅ 智能滚动加载,自动检测到底部
- ✅ 提取文字、图片、视频链接
- ✅ 导出为Markdown格式
- ✅ 同步到飞书多维表格

### 高级功能
- 🚧 增量更新(只采集新内容)
- 🚧 定时任务(每日自动采集)
- 🚧 数据去重
- 🚧 图片下载到本地
- 🚧 视频下载到本地

---

## 🎯 使用场景

1. **竞品分析**: 采集竞争对手的朋友圈,分析营销策略
2. **客户洞察**: 了解客户动态,发现销售机会
3. **内容备份**: 备份重要好友的朋友圈内容
4. **数据分析**: 分析朋友圈发布规律、热门话题等

---

## 🛠️ 技术实现

### 技术架构

```
┌─────────────────────────────────────────┐
│         微信APP(朋友圈界面)              │
└─────────────────────────────────────────┘
                 ↓ uiautomator2
┌─────────────────────────────────────────┐
│      moments_collector.py               │
│  ┌──────────────────────────────────┐  │
│  │  1. 初始化连接                    │  │
│  │  2. 启动微信                      │  │
│  │  3. 进入好友主页                  │  │
│  │  4. 进入朋友圈                    │  │
│  │  5. 滚动加载                      │  │
│  │  6. 提取数据                      │  │
│  └──────────────────────────────────┘  │
└─────────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────────┐
│      data_exporter.py                   │
│  ┌──────────────────────────────────┐  │
│  │  1. 数据清洗                      │  │
│  │  2. 生成Markdown                  │  │
│  │  3. 上传飞书                      │  │
│  └──────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

### 核心代码结构

```python
class MomentsCollector:
    def __init__(self, device_id=None):
        """初始化采集器"""
        self.d = u2.connect(device_id)
        self.moments_data = []
    
    def start_wechat(self):
        """启动微信"""
        pass
    
    def goto_friend_moments(self, friend_name):
        """进入好友朋友圈"""
        pass
    
    def scroll_and_collect(self):
        """滚动并采集数据"""
        pass
    
    def extract_moment_data(self, element):
        """提取单条朋友圈数据"""
        pass
    
    def export_to_markdown(self, output_path):
        """导出为Markdown"""
        pass
    
    def upload_to_feishu(self, table_id):
        """上传到飞书"""
        pass
```

---

## 📊 数据结构

### 朋友圈数据模型

```python
{
    "friend_name": "好友名称",
    "friend_id": "好友微信号",
    "moments": [
        {
            "id": "唯一ID",
            "timestamp": "发布时间",
            "content": "文字内容",
            "images": ["图片URL1", "图片URL2"],
            "videos": ["视频URL"],
            "location": "位置信息",
            "likes_count": 10,
            "comments_count": 5,
            "comments": [
                {
                    "user": "评论者",
                    "content": "评论内容",
                    "timestamp": "评论时间"
                }
            ]
        }
    ],
    "collected_at": "采集时间",
    "total_count": 100
}
```

### Markdown输出格式

```markdown
# 好友名称的朋友圈

**采集时间**: 2026-01-04 10:00:00
**总条数**: 100

---

## 2026-01-03 18:30

今天天气真好!

![图片1](image1.jpg)
![图片2](image2.jpg)

**位置**: 北京·朝阳区
**点赞**: 10人
**评论**: 5条

---

## 2026-01-02 12:00

分享一篇文章...

---
```

### 飞书多维表格结构

| 字段名 | 类型 | 说明 |
|--------|------|------|
| ID | 文本 | 唯一标识 |
| 好友名称 | 文本 | 好友昵称 |
| 发布时间 | 日期时间 | 朋友圈发布时间 |
| 内容 | 多行文本 | 文字内容 |
| 图片 | 附件 | 图片文件 |
| 视频 | 附件 | 视频文件 |
| 位置 | 文本 | 位置信息 |
| 点赞数 | 数字 | 点赞人数 |
| 评论数 | 数字 | 评论条数 |
| 采集时间 | 日期时间 | 数据采集时间 |

---

## 🚀 使用方法

### 命令行使用

```bash
# 采集单个好友
python src/main.py --mode moments --friend "张三"

# 采集多个好友
python src/main.py --mode moments --friends "张三,李四,王五"

# 采集所有好友(谨慎使用)
python src/main.py --mode moments --all

# 指定输出路径
python src/main.py --mode moments --friend "张三" --output ./data/moments/

# 上传到飞书
python src/main.py --mode moments --friend "张三" --feishu --table-id "xxx"
```

### 配置文件使用

编辑`config/config.ini`:

```ini
[MOMENTS]
# 采集模式: single(单个) | batch(批量) | all(全部)
mode = single

# 好友列表(逗号分隔)
friends = 张三,李四,王五

# 输出路径
output_path = ./data/moments/

# 是否上传飞书
upload_feishu = true

# 飞书表格ID
feishu_table_id = xxx

# 是否下载图片
download_images = true

# 是否下载视频
download_videos = false

# 滚动速度(秒)
scroll_speed = 0.5

# 滚动间隔(秒)
scroll_interval = 2

# 最大采集条数(0表示不限制)
max_count = 0
```

---

## ⚙️ 配置说明

### 必填配置
- `friends`: 要采集的好友列表
- `output_path`: 数据输出路径

### 可选配置
- `upload_feishu`: 是否上传到飞书,默认false
- `feishu_table_id`: 飞书表格ID
- `download_images`: 是否下载图片,默认false
- `download_videos`: 是否下载视频,默认false
- `scroll_speed`: 滚动速度,默认0.5秒
- `scroll_interval`: 滚动间隔,默认2秒
- `max_count`: 最大采集条数,默认0(不限制)

---

## 📈 性能指标

- **采集速度**: 约10-15条/分钟(取决于网络和内容复杂度)
- **准确率**: >95%(文字内容)
- **图片识别率**: >90%
- **内存占用**: <200MB
- **CPU占用**: <30%

---

## ⚠️ 注意事项

1. **首次使用需手动登录微信**
2. **建议使用小号测试**
3. **控制采集频率,避免被检测**
4. **大量采集建议分批进行**
5. **注意手机电量和网络稳定性**

---

## 🐛 已知问题

1. 部分朋友圈内容可能因权限问题无法采集
2. 视频链接提取可能不完整
3. 评论内容较多时可能遗漏

---

## 🔄 更新计划

- [ ] 支持增量更新
- [ ] 支持定时任务
- [ ] 优化图片下载速度
- [ ] 支持视频下载
- [ ] 添加数据分析功能

---

[返回README](../README.md) | [查看自动化文档](./自动化文档.md)

