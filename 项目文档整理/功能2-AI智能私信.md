# åŠŸèƒ½2: AIæ™ºèƒ½ç§ä¿¡

## ğŸ“– åŠŸèƒ½æ¦‚è¿°

è‡ªåŠ¨ç»™æŒ‡å®šå¥½å‹(æˆ–å…¨éƒ¨å¥½å‹)å‘é€ç§ä¿¡,ç»“åˆèŠå¤©è®°å½•è°ƒç”¨AIç”Ÿæˆä¸ªæ€§åŒ–æ–‡æ¡ˆ,æ”¯æŒçŸ¥è¯†åº“é›†æˆ,å®ç°æ™ºèƒ½åŒ–ã€ä¸ªæ€§åŒ–çš„ç§åŸŸè¿è¥ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸš§ è‡ªåŠ¨è¯»å–èŠå¤©è®°å½•
- ğŸš§ è°ƒç”¨AIç”Ÿæˆä¸ªæ€§åŒ–æ–‡æ¡ˆ
- ğŸš§ æ”¯æŒå•ä¸ªå¥½å‹å‘é€
- ğŸš§ æ”¯æŒæ‰¹é‡å¥½å‹å‘é€
- ğŸš§ æ™ºèƒ½æ§åˆ¶å‘é€é¢‘ç‡
- ğŸš§ å‘é€çŠ¶æ€è®°å½•å’Œç»Ÿè®¡

### é«˜çº§åŠŸèƒ½
- ğŸš§ çŸ¥è¯†åº“é›†æˆ(äº§å“ä»‹ç»ã€FAQç­‰)
- ğŸš§ å¤šè½®å¯¹è¯æ”¯æŒ
- ğŸš§ æƒ…æ„Ÿåˆ†æ(æ ¹æ®èŠå¤©è®°å½•åˆ¤æ–­æƒ…ç»ª)
- ğŸš§ å®šæ—¶å‘é€(ç”Ÿæ—¥ç¥ç¦ã€èŠ‚æ—¥é—®å€™ç­‰)
- ğŸš§ A/Bæµ‹è¯•(æµ‹è¯•ä¸åŒæ–‡æ¡ˆæ•ˆæœ)
- ğŸš§ è‡ªåŠ¨å›å¤(æ£€æµ‹åˆ°å›å¤åè‡ªåŠ¨åº”ç­”)

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

1. **å®¢æˆ·ç»´æŠ¤**: å®šæœŸç»™å®¢æˆ·å‘é€å…³æ€€ä¿¡æ¯,ä¿æŒè”ç³»
2. **äº§å“æ¨å¹¿**: æ ¹æ®å®¢æˆ·ç”»åƒæ¨é€ä¸ªæ€§åŒ–äº§å“ä¿¡æ¯
3. **æ´»åŠ¨é€šçŸ¥**: æ‰¹é‡é€šçŸ¥æ´»åŠ¨ä¿¡æ¯,æé«˜å‚ä¸ç‡
4. **ç”Ÿæ—¥ç¥ç¦**: è‡ªåŠ¨å‘é€ç”Ÿæ—¥ç¥ç¦,å¢å¼ºå®¢æˆ·ç²˜æ€§
5. **å”®åæœåŠ¡**: ä¸»åŠ¨è¯¢é—®ä½¿ç”¨æƒ…å†µ,æå‡æ»¡æ„åº¦

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¾®ä¿¡APP(èŠå¤©ç•Œé¢)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“ uiautomator2
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ai_messenger.py                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. è¯»å–èŠå¤©è®°å½•                  â”‚  â”‚
â”‚  â”‚  2. åˆ†æå®¢æˆ·ç”»åƒ                  â”‚  â”‚
â”‚  â”‚  3. è°ƒç”¨AIç”Ÿæˆæ–‡æ¡ˆ                â”‚  â”‚
â”‚  â”‚  4. å‘é€æ¶ˆæ¯                      â”‚  â”‚
â”‚  â”‚  5. è®°å½•å‘é€çŠ¶æ€                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COZE API    â”‚    â”‚  çŸ¥è¯†åº“(é£ä¹¦æ–‡æ¡£) â”‚
â”‚  OpenAI API  â”‚    â”‚  äº§å“ä¿¡æ¯        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä»£ç ç»“æ„

```python
class AIMessenger:
    def __init__(self, device_id=None, ai_config=None):
        """åˆå§‹åŒ–AIç§ä¿¡æ¨¡å—"""
        self.d = u2.connect(device_id)
        self.ai_client = self._init_ai_client(ai_config)
        self.knowledge_base = self._load_knowledge_base()
    
    def read_chat_history(self, friend_name, limit=50):
        """è¯»å–èŠå¤©è®°å½•"""
        pass
    
    def analyze_customer_profile(self, chat_history):
        """åˆ†æå®¢æˆ·ç”»åƒ"""
        pass
    
    def generate_message(self, friend_name, context):
        """è°ƒç”¨AIç”Ÿæˆæ–‡æ¡ˆ"""
        pass
    
    def send_message(self, friend_name, message):
        """å‘é€æ¶ˆæ¯"""
        pass
    
    def batch_send(self, friend_list, strategy='personalized'):
        """æ‰¹é‡å‘é€"""
        pass
    
    def schedule_send(self, friend_name, message, send_time):
        """å®šæ—¶å‘é€"""
        pass
```

---

## ğŸ“Š æ•°æ®ç»“æ„

### èŠå¤©è®°å½•æ•°æ®æ¨¡å‹

```python
{
    "friend_name": "å¥½å‹åç§°",
    "friend_id": "å¥½å‹å¾®ä¿¡å·",
    "chat_history": [
        {
            "timestamp": "2026-01-03 18:30:00",
            "sender": "æˆ‘",
            "message": "ä½ å¥½,æœ€è¿‘æ€ä¹ˆæ ·?",
            "type": "text"  # text/image/video/link
        },
        {
            "timestamp": "2026-01-03 18:31:00",
            "sender": "å¥½å‹",
            "message": "æŒºå¥½çš„,è°¢è°¢å…³å¿ƒ!",
            "type": "text"
        }
    ],
    "last_contact_time": "2026-01-03 18:31:00",
    "total_messages": 150,
    "relationship_score": 0.85  # å…³ç³»äº²å¯†åº¦è¯„åˆ†
}
```

### å®¢æˆ·ç”»åƒæ•°æ®æ¨¡å‹

```python
{
    "friend_name": "å¼ ä¸‰",
    "basic_info": {
        "gender": "ç”·",
        "age_range": "25-35",
        "location": "åŒ—äº¬",
        "occupation": "äº’è”ç½‘"
    },
    "interests": ["ç§‘æŠ€", "æ—…æ¸¸", "ç¾é£Ÿ"],
    "purchase_history": [
        {
            "product": "äº§å“A",
            "date": "2025-12-01",
            "amount": 299
        }
    ],
    "interaction_frequency": "é«˜",  # é«˜/ä¸­/ä½
    "last_interaction": "2026-01-03",
    "sentiment": "ç§¯æ",  # ç§¯æ/ä¸­æ€§/æ¶ˆæ
    "tags": ["æ½œåœ¨å®¢æˆ·", "é«˜ä»·å€¼", "æ´»è·ƒ"]
}
```

### AIç”Ÿæˆæ–‡æ¡ˆç¤ºä¾‹

```python
{
    "friend_name": "å¼ ä¸‰",
    "context": {
        "last_chat": "ä¸Šæ¬¡èŠåˆ°æ—…æ¸¸",
        "interests": ["æ—…æ¸¸", "æ‘„å½±"],
        "recent_moments": "æœ€è¿‘å‘äº†è¥¿è—æ—…æ¸¸çš„ç…§ç‰‡"
    },
    "generated_message": "å¼ ä¸‰,çœ‹åˆ°ä½ æœ€è¿‘å»äº†è¥¿è—,ç…§ç‰‡æ‹å¾—çœŸç¾!æˆ‘ä»¬æ–°æ¨å‡ºäº†ä¸€æ¬¾æ—…è¡Œæ‘„å½±è¯¾ç¨‹,ä¸“é—¨æ•™å¦‚ä½•åœ¨æ—…é€”ä¸­æ‹å‡ºå¤§ç‰‡,æ„Ÿè§‰å¾ˆé€‚åˆä½ ,è¦ä¸è¦äº†è§£ä¸€ä¸‹?",
    "tone": "å‹å¥½",  # å‹å¥½/ä¸“ä¸š/å¹½é»˜
    "call_to_action": "äº†è§£è¯¾ç¨‹",
    "confidence": 0.92  # AIç”Ÿæˆç½®ä¿¡åº¦
}
```

---

## ğŸ¤– AIé›†æˆæ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€: COZE API (æ¨è)

**ä¼˜åŠ¿**:
- æ”¯æŒè‡ªå®šä¹‰çŸ¥è¯†åº“
- æ”¯æŒFunction Calling
- æ”¯æŒWorkflowè®¾è®¡
- ä¸­æ–‡æ”¯æŒå¥½

**é…ç½®ç¤ºä¾‹**:
```python
# config/ai_config.json
{
    "provider": "coze",
    "api_key": "your_coze_api_key",
    "bot_id": "your_bot_id",
    "knowledge_base_id": "your_kb_id",
    "temperature": 0.7,
    "max_tokens": 500
}
```

**è°ƒç”¨ç¤ºä¾‹**:
```python
import requests

def call_coze_api(context):
    url = "https://api.coze.com/v1/chat"
    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json"
    }
    data = {
        "bot_id": bot_id,
        "user_id": "user_123",
        "messages": [
            {
                "role": "user",
                "content": f"æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆç§ä¿¡æ–‡æ¡ˆ:\n{context}"
            }
        ]
    }
    response = requests.post(url, headers=headers, json=data)
    return response.json()
```

---

### æ–¹æ¡ˆäºŒ: OpenAI API

**ä¼˜åŠ¿**:
- æ¨¡å‹èƒ½åŠ›å¼º
- ç¤¾åŒºèµ„æºä¸°å¯Œ
- æ”¯æŒå¤šç§æ¨¡å‹

**é…ç½®ç¤ºä¾‹**:
```python
# config/ai_config.json
{
    "provider": "openai",
    "api_key": "your_openai_api_key",
    "model": "gpt-4",
    "temperature": 0.7,
    "max_tokens": 500
}
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# ç»™å•ä¸ªå¥½å‹å‘é€AIç”Ÿæˆçš„æ¶ˆæ¯
python src/main.py --mode ai-message --friend "å¼ ä¸‰"

# æ‰¹é‡å‘é€(ä¸ªæ€§åŒ–æ–‡æ¡ˆ)
python src/main.py --mode ai-message --friends "å¼ ä¸‰,æå››,ç‹äº”" --strategy personalized

# æ‰¹é‡å‘é€(ç»Ÿä¸€æ–‡æ¡ˆ)
python src/main.py --mode ai-message --friends "å¼ ä¸‰,æå››,ç‹äº”" --strategy unified --message "æ–°å¹´å¿«ä¹!"

# å®šæ—¶å‘é€
python src/main.py --mode ai-message --friend "å¼ ä¸‰" --schedule "2026-01-05 10:00:00"

# æµ‹è¯•æ¨¡å¼(ä¸å®é™…å‘é€)
python src/main.py --mode ai-message --friend "å¼ ä¸‰" --dry-run
```

### é…ç½®æ–‡ä»¶ä½¿ç”¨

ç¼–è¾‘`config/config.ini`:

```ini
[AI_MESSAGE]
# AIæä¾›å•†: coze | openai
ai_provider = coze

# APIå¯†é’¥
api_key = your_api_key

# çŸ¥è¯†åº“ID
knowledge_base_id = your_kb_id

# å‘é€ç­–ç•¥: personalized(ä¸ªæ€§åŒ–) | unified(ç»Ÿä¸€)
strategy = personalized

# å‘é€é—´éš”(ç§’)
send_interval = 30

# æ¯æ—¥æœ€å¤§å‘é€æ•°
max_daily_send = 50

# æ˜¯å¦è¯»å–èŠå¤©è®°å½•
read_chat_history = true

# èŠå¤©è®°å½•æ¡æ•°
chat_history_limit = 50

# æ–‡æ¡ˆç”Ÿæˆæ¸©åº¦(0-1)
temperature = 0.7

# æ–‡æ¡ˆæœ€å¤§é•¿åº¦
max_message_length = 200
```

---

## ğŸ“ˆ å‘é€ç­–ç•¥

### ä¸ªæ€§åŒ–ç­–ç•¥
- è¯»å–æ¯ä¸ªå¥½å‹çš„èŠå¤©è®°å½•
- åˆ†æå®¢æˆ·ç”»åƒå’Œå…´è¶£
- ç”Ÿæˆä¸ªæ€§åŒ–æ–‡æ¡ˆ
- é€‚åˆé«˜ä»·å€¼å®¢æˆ·

### ç»Ÿä¸€ç­–ç•¥
- ä½¿ç”¨ç»Ÿä¸€çš„æ–‡æ¡ˆæ¨¡æ¿
- å¯æ’å…¥å¥½å‹åç§°ç­‰å˜é‡
- å‘é€é€Ÿåº¦å¿«
- é€‚åˆæ‰¹é‡é€šçŸ¥

### åˆ†ç»„ç­–ç•¥
- æ ¹æ®æ ‡ç­¾åˆ†ç»„
- æ¯ç»„ä½¿ç”¨ä¸åŒæ–‡æ¡ˆ
- å¹³è¡¡ä¸ªæ€§åŒ–å’Œæ•ˆç‡

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸¥æ ¼æ§åˆ¶å‘é€é¢‘ç‡**: é¿å…è¢«å¾®ä¿¡æ£€æµ‹ä¸ºè¥é”€å·
2. **ä½¿ç”¨å°å·æµ‹è¯•**: å…ˆç”¨å°å·æµ‹è¯•,ç¡®è®¤æ— é—®é¢˜åå†ç”¨ä¸»å·
3. **å°Šé‡ç”¨æˆ·æ„æ„¿**: å¦‚æœç”¨æˆ·æ˜ç¡®æ‹’ç»,ä¸è¦ç»§ç»­å‘é€
4. **å†…å®¹åˆè§„**: ä¸å‘é€è¿è§„å†…å®¹,é¿å…è´¦å·è¢«å°
5. **ä¿æŠ¤éšç§**: ä¸æ³„éœ²ç”¨æˆ·èŠå¤©è®°å½•å’Œä¸ªäººä¿¡æ¯

---

## ğŸ”„ æ›´æ–°è®¡åˆ’

- [ ] å®ŒæˆèŠå¤©è®°å½•è¯»å–åŠŸèƒ½
- [ ] é›†æˆCOZE API
- [ ] å®ç°ä¸ªæ€§åŒ–æ–‡æ¡ˆç”Ÿæˆ
- [ ] æ·»åŠ å‘é€é¢‘ç‡æ§åˆ¶
- [ ] æ”¯æŒå®šæ—¶å‘é€
- [ ] æ·»åŠ A/Bæµ‹è¯•åŠŸèƒ½

---

[è¿”å›README](../README.md) | [æŸ¥çœ‹è‡ªåŠ¨åŒ–æ–‡æ¡£](./è‡ªåŠ¨åŒ–æ–‡æ¡£.md)

